<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright 2009 Inspire-Software.com
  ~
  ~    Licensed under the Apache License, Version 2.0 (the "License");
  ~    you may not use this file except in compliance with the License.
  ~    You may obtain a copy of the License at
  ~
  ~        http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~    Unless required by applicable law or agreed to in writing, software
  ~    distributed under the License is distributed on an "AS IS" BASIS,
  ~    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~    See the License for the specific language governing permissions and
  ~    limitations under the License.
  -->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:cache="http://www.springframework.org/schema/cache"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/cache
	                       http://www.springframework.org/schema/cache/spring-cache.xsd">

    <cache:annotation-driven />

    <import resource="cache-config.xml"/>

    <import resource="classpath:dao.xml"/>
    <import resource="dao-index-support.xml"/>

    <bean id="shopSearchSupportService" class="org.yes.cart.search.impl.ShopSearchSupportServiceImpl">
        <constructor-arg index="0" ref="shopService"/>
        <constructor-arg index="1" ref="categoryService"/>
    </bean>

    <bean id="systemService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.SystemServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="systemDao"/>
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="attrValueEntitySystemDao"/>
                <constructor-arg type="org.yes.cart.service.domain.AttributeService" ref="attributeService"/>
                <constructor-arg type="org.yes.cart.service.domain.RuntimeAttributeService" ref="runtimeAttributeService"/>
                <constructor-arg type="org.springframework.cache.CacheManager" ref="cacheManager"/>
                <lookup-method name="getSelf" bean="systemService"/>
                <property name="config" ref="runtimeConstants"/>
            </bean>
        </property>
    </bean>

    <bean id="shopService" class="org.yes.cart.service.domain.impl.ShopServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.domain.impl.ShopServiceImpl">
                        <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="shopDao"/>
                        <constructor-arg type="org.yes.cart.service.domain.CategoryService" ref="categoryService"/>
                        <constructor-arg type="org.yes.cart.service.domain.ContentService" ref="contentService"/>
                        <constructor-arg type="org.yes.cart.service.domain.AttributeService" ref="attributeService"/>
                        <constructor-arg type="org.yes.cart.search.dao.support.ShopCategoryRelationshipSupport" ref="shopCategoryRelationshipSupport"/>
                        <lookup-method name="getSelf" bean="shopService"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>


    <bean id="shoppingCartStateService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ShoppingCartStateServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="shoppingCartStateDao"/>
            </bean>
        </property>
    </bean>


    <bean id="shopUrlService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ShopUrlServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="shopUrlDao"/>
            </bean>
        </property>
    </bean>

    <bean id="shopAliasService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ShopAliasServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="shopAliasDao"/>
            </bean>
        </property>
    </bean>

    <bean id="categoryService" class="org.yes.cart.service.domain.impl.CategoryServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.domain.impl.CategoryServiceImpl">
                        <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="categoryDao"/>
                        <constructor-arg type="org.yes.cart.search.dao.support.ShopCategoryRelationshipSupport" ref="shopCategoryRelationshipSupport"/>
                        <lookup-method name="getSelf" bean="categoryService"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="contentServiceTemplateSupport" class="org.yes.cart.service.theme.templates.impl.TemplateProcessorFactoryImpl">
        <constructor-arg>
            <array>
                <bean class="org.yes.cart.service.domain.impl.ContentServiceTemplateSupportThymeleafImpl">
                    <constructor-arg>
                        <bean class="org.yes.cart.service.theme.templates.impl.ThymeleafTemplateSupportImpl">
                            <constructor-arg ref="cacheManager"/>
                        </bean>
                    </constructor-arg>
                </bean>
                <bean class="org.yes.cart.service.domain.impl.ContentServiceTemplateSupportGroovyImpl">
                    <constructor-arg>
                        <bean class="org.yes.cart.service.theme.templates.impl.GroovySimpleTemplateSupportImpl">
                            <constructor-arg ref="cacheManager"/>
                        </bean>
                    </constructor-arg>
                </bean>
            </array>
        </constructor-arg>
    </bean>

    <bean id="contentServiceCMS3" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ContentServiceCMS3Impl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="contentDao"/>
                <constructor-arg type="org.yes.cart.service.theme.templates.TemplateProcessor" ref="contentServiceTemplateSupport"/>
                <lookup-method name="getSelf" bean="contentService"/>
                <property name="cfgContext">
                    <bean class="org.yes.cart.config.impl.ConfigurationContextImpl">
                        <property name="functionalArea" value="CMS"/>
                        <property name="name" value="contentServiceCMS3"/>
                        <property name="cfgInterface" value="ContentService"/>
                        <property name="cfgDefault" value="true"/>
                        <property name="properties">
                            <props>
                                <prop key="extension">SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]</prop>
                                <prop key="description">Default service that can be overridden via system properties (Disable by commenting out in SYSTEM_EXTENSION_CFG_PROPERTIES using '#')</prop>
                                <prop key="SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]">CMS.contentService=contentServiceCMS3</prop>
                            </props>
                        </property>
                    </bean>
                </property>
            </bean>
        </property>
    </bean>

    <bean id="contentService" class="org.yes.cart.service.domain.impl.ContentServiceCachedImpl">
        <constructor-arg ref="contentServiceCMS3"/>
    </bean>

    <bean id="prodTypeAttributeViewGroupService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ProdTypeAttributeViewGroupServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="prodTypeAttributeViewGroupDao"/>
            </bean>
        </property>
    </bean>

    <bean id="productService" class="org.yes.cart.service.domain.impl.ProductServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.domain.impl.ProductServiceImpl">
                        <constructor-arg index="0" type="org.yes.cart.dao.GenericFTSCapableDAO" ref="productDao"/>
                        <constructor-arg index="1" type="org.yes.cart.dao.GenericFTSCapableDAO" ref="productSkuDao"/>
                        <constructor-arg index="2" type="org.yes.cart.service.domain.ProductSkuService" ref="productSkuService"/>
                        <constructor-arg index="3" type="org.yes.cart.service.domain.ProductTypeAttrService" ref="productTypeAttrService"/>
                        <constructor-arg index="4" type="org.yes.cart.service.domain.AttributeService" ref="attributeService"/>
                        <constructor-arg index="5" type="org.yes.cart.dao.GenericDAO" ref="productCategoryDao"/>
                        <constructor-arg index="6" type="org.yes.cart.dao.GenericDAO" ref="productTypeAttrDao"/>
                        <constructor-arg index="7" type="org.yes.cart.search.dao.support.ShopCategoryRelationshipSupport" ref="shopCategoryRelationshipSupport"/>
                        <lookup-method name="getSelf" bean="productService"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="productSkuService" class="org.yes.cart.service.domain.impl.ProductSkuServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.domain.impl.ProductSkuServiceImpl">
                        <constructor-arg index="0" type="org.yes.cart.dao.GenericFTSCapableDAO" ref="productSkuDao"/>
                        <constructor-arg index="1" type="org.yes.cart.dao.GenericFTSCapableDAO" ref="productDao"/>
                        <constructor-arg index="2" type="org.yes.cart.dao.GenericDAO" ref="skuPriceDao"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="productAvailabilityStrategyDefault" class="org.yes.cart.shoppingcart.impl.ProductAvailabilityStrategyDefaultImpl">
        <constructor-arg index="0" ref="warehouseService"/>
        <constructor-arg index="1" ref="inventoryResolver"/>
        <property name="cfgContext">
            <bean class="org.yes.cart.config.impl.ConfigurationContextImpl">
                <property name="functionalArea" value="inventory"/>
                <property name="name" value="productAvailabilityStrategyDefault"/>
                <property name="cfgInterface" value="ProductAvailabilityStrategy"/>
                <property name="cfgDefault" value="true"/>
                <property name="properties">
                    <props>
                        <prop key="extension">SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]</prop>
                        <prop key="description">Default service that can be overridden via system properties (Disable by commenting out in SYSTEM_EXTENSION_CFG_PROPERTIES using '#')</prop>
                        <prop key="SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]">SHOPCODE.productAvailabilityStrategy=configurationBeanName, where SHOPCODE is the code of the shop and configurationBeanName is custom implementation</prop>
                    </props>
                </property>
            </bean>
        </property>
    </bean>


    <bean id="productAvailabilityStrategyBackorderInStockOnly" class="org.yes.cart.shoppingcart.impl.ProductAvailabilityStrategyBackorderInStockOnlyImpl">
        <constructor-arg index="0" ref="warehouseService"/>
        <constructor-arg index="1" ref="inventoryResolver"/>
        <property name="cfgContext">
            <bean class="org.yes.cart.config.impl.ConfigurationContextImpl">
                <property name="functionalArea" value="inventory"/>
                <property name="name" value="ProductAvailabilityStrategyBackorderInStockOnly"/>
                <property name="cfgInterface" value="ProductAvailabilityStrategy"/>
                <property name="cfgDefault" value="false"/>
                <property name="properties">
                    <props>
                        <prop key="extension">SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]</prop>
                        <prop key="description">Custome service for availability determination, makes BACKORDER items without stock show as unavailable (Disable by commenting out in SYSTEM_EXTENSION_CFG_PROPERTIES using '#')</prop>
                        <prop key="SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]">SHOPCODE.productAvailabilityStrategy=productAvailabilityStrategyBackorderInStockOnly, where SHOPCODE is the code of the shop</prop>
                    </props>
                </property>
            </bean>
        </property>
    </bean>


    <bean id="productAvailabilityStrategy"
          class="org.yes.cart.shoppingcart.impl.ProductAvailabilityStrategyImpl">
        <constructor-arg index="0" ref="productAvailabilityStrategyDefault"/>
    </bean>


    <bean id="productQuantityStrategyDefault" class="org.yes.cart.shoppingcart.impl.ProductQuantityStrategyDefaultImpl">
        <constructor-arg index="0" ref="warehouseService"/>
        <constructor-arg index="1" ref="inventoryResolver"/>
        <property name="cfgContext">
            <bean class="org.yes.cart.config.impl.ConfigurationContextImpl">
                <property name="functionalArea" value="inventory"/>
                <property name="name" value="productAvailabilityStrategyDefault"/>
                <property name="cfgInterface" value="ProductAvailabilityStrategy"/>
                <property name="cfgDefault" value="true"/>
                <property name="properties">
                    <props>
                        <prop key="extension">SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]</prop>
                        <prop key="description">Default service that can be overridden via system properties (Disable by commenting out in SYSTEM_EXTENSION_CFG_PROPERTIES using '#')</prop>
                        <prop key="SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]">SHOPCODE.productAvailabilityStrategy=configurationBeanName, where SHOPCODE is the code of the shop and configurationBeanName is custom implementation</prop>
                    </props>
                </property>
            </bean>
        </property>
    </bean>

    <bean id="productQuantityStrategy"
          class="org.yes.cart.shoppingcart.impl.ProductQuantityStrategyImpl">
        <constructor-arg index="0" ref="productQuantityStrategyDefault"/>
    </bean>

    <bean id="addressService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.AddressServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="addressDao"/>
                <constructor-arg index="1" type="org.yes.cart.service.order.OrderAddressFormatter" ref="orderAddressFormatter"/>
            </bean>
        </property>
    </bean>


    <bean id="shopAddressCustomisationSupport" class="org.yes.cart.service.domain.impl.ShopAddressCustomisationSupportImpl">
        <constructor-arg index="0" ref="addressService"/>
        <constructor-arg index="1" ref="countryService"/>
        <constructor-arg index="2" ref="stateService"/>
        <constructor-arg index="3" ref="shopService"/>
        <constructor-arg index="4" ref="attributeService"/>
    </bean>


    <bean id="customerWishListService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.CustomerWishListServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="customerWishListDao"/>
            </bean>
        </property>
    </bean>


    <bean id="attributeService" class="org.yes.cart.service.domain.impl.AttributeServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.domain.impl.AttributeServiceImpl">
                        <constructor-arg index="0" ref="attributeDao"/>
                        <constructor-arg index="1" ref="attributeGroupService"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="runtimeAttributeService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.RuntimeAttributeServiceImpl">
                <constructor-arg index="0" ref="attributeService"/>
            </bean>
        </property>
    </bean>


    <!--     #############################   Media section begin   #############################    -->

    <bean id="categoryImageNameStrategy" class="org.yes.cart.service.media.impl.MediaFileNameStrategyCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean  class="org.yes.cart.service.media.impl.CategoryMediaFileNameStrategyImpl">
                        <constructor-arg index="0" value="/imgvault/category/"/>
                        <constructor-arg index="1" value="category"/>
                        <constructor-arg index="2" ref="attrValueEntityCategoryDao"/>
                        <constructor-arg index="3" ref="languageService"/>
                        <property name="attributePrefix" value="CATEGORY_IMAGE"/>
                    </bean>
                </property>
                <property name="transactionAttributes">
                    <props>
                        <prop key="resolveObjectCode">PROPAGATION_REQUIRED,readOnly,-Throwable</prop>
                        <prop key="*">PROPAGATION_NOT_SUPPORTED</prop>
                    </props>
                </property>
            </bean>
        </constructor-arg>
    </bean>


    <bean id="contentCMS3ImageNameStrategy" class="org.yes.cart.service.media.impl.MediaFileNameStrategyConfigurableCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean  class="org.yes.cart.service.media.impl.ContentCMS3MediaFileNameStrategyImpl">
                        <constructor-arg index="0" value="/imgvault/content/"/>
                        <constructor-arg index="1" value="content"/>
                        <constructor-arg index="2" ref="attrValueEntityContentDao"/>
                        <constructor-arg index="3" ref="languageService"/>
                        <property name="attributePrefix" value="CATEGORY_IMAGE"/>
                    </bean>
                </property>
                <property name="transactionAttributes">
                    <props>
                        <prop key="resolveObjectCode">PROPAGATION_REQUIRED,readOnly,-Throwable</prop>
                        <prop key="*">PROPAGATION_NOT_SUPPORTED</prop>
                    </props>
                </property>
            </bean>
        </constructor-arg>
        <property name="cfgContext">
            <bean class="org.yes.cart.config.impl.ConfigurationContextImpl">
                <property name="functionalArea" value="CMS"/>
                <property name="name" value="contentCMS3ImageNameStrategy"/>
                <property name="cfgInterface" value="MediaFileNameStrategy"/>
                <property name="cfgDefault" value="true"/>
                <property name="properties">
                    <props>
                        <prop key="extension">SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]</prop>
                        <prop key="description">Default service that can be overridden via system properties (Disable by commenting out in SYSTEM_EXTENSION_CFG_PROPERTIES using '#')</prop>
                        <prop key="SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]">CMS.contentImageNameStrategy=contentCMS3ImageNameStrategy</prop>
                    </props>
                </property>
            </bean>
        </property>
    </bean>

    <bean id="contentImageNameStrategy" class="org.yes.cart.service.media.impl.ContentMediaFileNameStrategyFactoryImpl">
        <constructor-arg ref="contentCMS3ImageNameStrategy"/>
        <property name="allowKey" value="contentImageNameStrategy"/>
    </bean>

    <bean id="productImageNameStrategy" class="org.yes.cart.service.media.impl.MediaFileNameStrategyCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean  class="org.yes.cart.service.media.impl.ProductMediaFileNameStrategyImpl">
                        <constructor-arg index="0" value="/imgvault/product/"/>
                        <constructor-arg index="1" value="product"/>
                        <constructor-arg index="2" ref="attrValueEntityProductSkuDao"/>
                        <constructor-arg index="3" ref="attrValueEntityProductDao"/>
                        <constructor-arg index="4" ref="languageService"/>
                        <property name="attributePrefix" value="IMAGE"/>
                    </bean>
                </property>
                <property name="transactionAttributes">
                    <props>
                        <prop key="resolveObjectCode">PROPAGATION_REQUIRED,readOnly,-Throwable</prop>
                        <prop key="*">PROPAGATION_NOT_SUPPORTED</prop>
                    </props>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="brandImageNameStrategy" class="org.yes.cart.service.media.impl.MediaFileNameStrategyCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean  class="org.yes.cart.service.media.impl.BrandMediaFileNameStrategyImpl">
                        <constructor-arg index="0" value="/imgvault/brand/"/>
                        <constructor-arg index="1" value="brand"/>
                        <constructor-arg index="2" ref="attrValueEntityBrandDao"/>
                        <constructor-arg index="3" ref="languageService"/>
                        <property name="attributePrefix" value="BRAND_IMAGE"/>
                    </bean>
                </property>
                <property name="transactionAttributes">
                    <props>
                        <prop key="resolveObjectCode">PROPAGATION_REQUIRED,readOnly,-Throwable</prop>
                        <prop key="*">PROPAGATION_NOT_SUPPORTED</prop>
                    </props>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="shopImageNameStrategy" class="org.yes.cart.service.media.impl.MediaFileNameStrategyCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.media.impl.ShopMediaFileNameStrategyImpl">
                        <constructor-arg index="0" value="/imgvault/shop/"/>
                        <constructor-arg index="1" value="shop"/>
                        <constructor-arg index="2" ref="attrValueEntityShopDao"/>
                        <constructor-arg index="3" ref="languageService"/>
                        <property name="attributePrefix" value="SHOP_IMAGE"/>
                    </bean>
                </property>
                <property name="transactionAttributes">
                    <props>
                        <prop key="resolveObjectCode">PROPAGATION_REQUIRED,readOnly,-Throwable</prop>
                        <prop key="*">PROPAGATION_NOT_SUPPORTED</prop>
                    </props>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="systemImageNameStrategy" class="org.yes.cart.service.media.impl.MediaFileNameStrategyCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.media.impl.SystemMediaFileNameStrategyImpl">
                        <constructor-arg index="0" value="/imgvault/system/"/>
                        <constructor-arg index="1" value="system"/>
                        <constructor-arg index="2" ref="languageService"/>
                        <property name="attributePrefix" value="SYSTEM_IMAGE"/>
                    </bean>
                </property>
                <property name="transactionAttributes">
                    <props>
                        <prop key="resolveObjectCode">PROPAGATION_REQUIRED,readOnly,-Throwable</prop>
                        <prop key="*">PROPAGATION_NOT_SUPPORTED</prop>
                    </props>
                </property>
            </bean>
        </constructor-arg>
    </bean>


    <bean id="imageNameStrategyResolverStrategies" class="org.yes.cart.utils.spring.ArrayListBeanImpl">
        <constructor-arg>
            <list>
                <ref bean="categoryImageNameStrategy"/>
                <ref bean="contentImageNameStrategy"/>
                <ref bean="brandImageNameStrategy"/>
                <ref bean="productImageNameStrategy"/>
                <ref bean="shopImageNameStrategy"/>
                <ref bean="systemImageNameStrategy"/>
            </list>
        </constructor-arg>
    </bean>

    <bean id="imageNameStrategyResolver" class="org.yes.cart.service.media.impl.MediaFileNameStrategyResolverImpl">
        <constructor-arg index="0" ref="productImageNameStrategy"/>
        <constructor-arg index="1" ref="imageNameStrategyResolverStrategies"/>
    </bean>

    <!--
    Responsible:
        image resizing;
        storing images into repository during bulk import;
        work with brand, product, sku and category images.
    -->

    <bean id="imageService" class="org.yes.cart.service.domain.impl.ImageServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean  class="org.yes.cart.service.domain.impl.ImageServiceImpl">
                        <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="seoImageDao"/>
                        <constructor-arg type="org.yes.cart.service.media.MediaFileNameStrategyResolver" ref="imageNameStrategyResolver"/>
                        <!--
                            Allowed pictures sizes to resize. Original image will be returned if requested size not allowed.
                        -->
                        <constructor-arg type="java.lang.String" value="40x40,50x50,60x60,80x80,200x200,160x160,360x360,120x120,280x280,240x240"/>
                        <!--
                            Background RGB color for re-sized picture. When picture is scaled this is the border
                            color around the picture where it does not fill all the space
                        -->
                        <constructor-arg type="int" value="255"/>
                        <constructor-arg type="int" value="255"/>
                        <constructor-arg type="int" value="255"/>
                        <!--
                            cropToFit setting this to true will crop the image to proper ratio prior to scaling
                            so that scaled image fills all the space. This is useful for those who wish to have
                            images that fill all space dedicated for image without having border around the image.
                            For those who wish images of products in the middle e.g. as it is in YC demo better
                            to set this to false.
                        -->
                        <constructor-arg type="boolean" value="false"/>
                        <!--
                            forceCropToFitOnSize forcefully use cropping if scale is below given size.
                            This option is very useful for small thumbs (<100px), as you really cannot see much with
                            added padding for panoramic or tall images.
                        -->
                        <constructor-arg type="int" value="100"/>
                        <!--
                            replaceFilesModeOn if set to true will overwrite existing file if name is
                            the same. Recommended setting is 'true' because the import service refers to the
                            original filename and thus does not save the rolling filename.
                         -->
                        <constructor-arg type="boolean" value="true"/>
                        <!--
                            IO operations abstraction
                         -->
                        <constructor-arg type="org.yes.cart.stream.io.IOProvider" ref="ioProviderFactory"/>
                        <!--
                            System Service allows to provide system wide settings
                         -->
                        <lookup-method name="getSystemService" bean="systemService"/>

                        <property name="config" ref="runtimeConstants"/>

                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>



    <bean id="categoryFileNameStrategy" class="org.yes.cart.service.media.impl.MediaFileNameStrategyCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean  class="org.yes.cart.service.media.impl.CategoryMediaFileNameStrategyImpl">
                        <constructor-arg index="0" value="/filevault/category/"/>
                        <constructor-arg index="1" value="category"/>
                        <constructor-arg index="2" ref="attrValueEntityCategoryDao"/>
                        <constructor-arg index="3" ref="languageService"/>
                        <property name="attributePrefix" value="CATEGORY_FILE"/>
                    </bean>
                </property>
                <property name="transactionAttributes">
                    <props>
                        <prop key="resolveObjectCode">PROPAGATION_REQUIRED,readOnly,-Throwable</prop>
                        <prop key="*">PROPAGATION_NOT_SUPPORTED</prop>
                    </props>
                </property>
            </bean>
        </constructor-arg>
    </bean>


    <bean id="contentCMS3FileNameStrategy" class="org.yes.cart.service.media.impl.MediaFileNameStrategyConfigurableCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean  class="org.yes.cart.service.media.impl.ContentCMS3MediaFileNameStrategyImpl">
                        <constructor-arg index="0" value="/filevault/content/"/>
                        <constructor-arg index="1" value="content"/>
                        <constructor-arg index="2" ref="attrValueEntityContentDao"/>
                        <constructor-arg index="3" ref="languageService"/>
                        <property name="attributePrefix" value="CATEGORY_FILE"/>
                    </bean>
                </property>
                <property name="transactionAttributes">
                    <props>
                        <prop key="resolveObjectCode">PROPAGATION_REQUIRED,readOnly,-Throwable</prop>
                        <prop key="*">PROPAGATION_NOT_SUPPORTED</prop>
                    </props>
                </property>
            </bean>
        </constructor-arg>
        <property name="cfgContext">
            <bean class="org.yes.cart.config.impl.ConfigurationContextImpl">
                <property name="functionalArea" value="CMS"/>
                <property name="name" value="contentCMS3FileNameStrategy"/>
                <property name="cfgInterface" value="MediaFileNameStrategy"/>
                <property name="cfgDefault" value="true"/>
                <property name="properties">
                    <props>
                        <prop key="extension">SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]</prop>
                        <prop key="description">Default service that can be overridden via system properties (Disable by commenting out in SYSTEM_EXTENSION_CFG_PROPERTIES using '#')</prop>
                        <prop key="SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]">CMS.contentFileNameStrategy=contentCMS3FileNameStrategy</prop>
                    </props>
                </property>
            </bean>
        </property>
    </bean>

    <bean id="contentFileNameStrategy" class="org.yes.cart.service.media.impl.ContentMediaFileNameStrategyFactoryImpl">
        <constructor-arg ref="contentCMS3FileNameStrategy"/>
        <property name="allowKey" value="contentFileNameStrategy"/>
    </bean>


    <bean id="productFileNameStrategy" class="org.yes.cart.service.media.impl.MediaFileNameStrategyCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean  class="org.yes.cart.service.media.impl.ProductMediaFileNameStrategyImpl">
                        <constructor-arg index="0" value="/filevault/product/"/>
                        <constructor-arg index="1" value="product"/>
                        <constructor-arg index="2" ref="attrValueEntityProductSkuDao"/>
                        <constructor-arg index="3" ref="attrValueEntityProductDao"/>
                        <constructor-arg index="4" ref="languageService"/>
                        <property name="attributePrefix" value="FILE"/>
                    </bean>
                </property>
                <property name="transactionAttributes">
                    <props>
                        <prop key="resolveObjectCode">PROPAGATION_REQUIRED,readOnly,-Throwable</prop>
                        <prop key="*">PROPAGATION_NOT_SUPPORTED</prop>
                    </props>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="brandFileNameStrategy" class="org.yes.cart.service.media.impl.MediaFileNameStrategyCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean  class="org.yes.cart.service.media.impl.BrandMediaFileNameStrategyImpl">
                        <constructor-arg index="0" value="/filevault/brand/"/>
                        <constructor-arg index="1" value="brand"/>
                        <constructor-arg index="2" ref="attrValueEntityBrandDao"/>
                        <constructor-arg index="3" ref="languageService"/>
                        <property name="attributePrefix" value="BRAND_FILE"/>
                    </bean>
                </property>
                <property name="transactionAttributes">
                    <props>
                        <prop key="resolveObjectCode">PROPAGATION_REQUIRED,readOnly,-Throwable</prop>
                        <prop key="*">PROPAGATION_NOT_SUPPORTED</prop>
                    </props>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="shopFileNameStrategy" class="org.yes.cart.service.media.impl.MediaFileNameStrategyCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.media.impl.ShopMediaFileNameStrategyImpl">
                        <constructor-arg index="0" value="/filevault/shop/"/>
                        <constructor-arg index="1" value="shop"/>
                        <constructor-arg index="2" ref="attrValueEntityShopDao"/>
                        <constructor-arg index="3" ref="languageService"/>
                        <property name="attributePrefix" value="SHOP_FILE"/>
                    </bean>
                </property>
                <property name="transactionAttributes">
                    <props>
                        <prop key="resolveObjectCode">PROPAGATION_REQUIRED,readOnly,-Throwable</prop>
                        <prop key="*">PROPAGATION_NOT_SUPPORTED</prop>
                    </props>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="shopSystemFileNameStrategy" class="org.yes.cart.service.media.impl.MediaFileNameStrategyCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.media.impl.ShopMediaFileNameStrategyImpl">
                        <constructor-arg index="0" value="/sysfilevault/shop/"/>
                        <constructor-arg index="1" value="shop"/>
                        <constructor-arg index="2" ref="attrValueEntityShopDao"/>
                        <constructor-arg index="3" ref="languageService"/>
                        <property name="attributePrefix" value="SHOP_SYSFILE"/>
                    </bean>
                </property>
                <property name="transactionAttributes">
                    <props>
                        <prop key="resolveObjectCode">PROPAGATION_REQUIRED,readOnly,-Throwable</prop>
                        <prop key="*">PROPAGATION_NOT_SUPPORTED</prop>
                    </props>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="systemFileNameStrategy" class="org.yes.cart.service.media.impl.MediaFileNameStrategyCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.media.impl.SystemMediaFileNameStrategyImpl">
                        <constructor-arg index="0" value="/filevault/system/"/>
                        <constructor-arg index="1" value="system"/>
                        <constructor-arg index="2" ref="languageService"/>
                        <property name="attributePrefix" value="SYSTEM_FILE"/>
                    </bean>
                </property>
                <property name="transactionAttributes">
                    <props>
                        <prop key="resolveObjectCode">PROPAGATION_REQUIRED,readOnly,-Throwable</prop>
                        <prop key="*">PROPAGATION_NOT_SUPPORTED</prop>
                    </props>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="systemSystemFileNameStrategy" class="org.yes.cart.service.media.impl.MediaFileNameStrategyCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.media.impl.SystemMediaFileNameStrategyImpl">
                        <constructor-arg index="0" value="/sysfilevault/system/"/>
                        <constructor-arg index="1" value="system"/>
                        <constructor-arg index="2" ref="languageService"/>
                        <property name="attributePrefix" value="SYSTEM_SYSFILE"/>
                    </bean>
                </property>
                <property name="transactionAttributes">
                    <props>
                        <prop key="resolveObjectCode">PROPAGATION_REQUIRED,readOnly,-Throwable</prop>
                        <prop key="*">PROPAGATION_NOT_SUPPORTED</prop>
                    </props>
                </property>
            </bean>
        </constructor-arg>
    </bean>


    <bean id="fileNameStrategyResolverStrategies" class="org.yes.cart.utils.spring.ArrayListBeanImpl">
        <constructor-arg>
            <list>
                <ref bean="categoryFileNameStrategy"/>
                <ref bean="contentFileNameStrategy"/>
                <ref bean="brandFileNameStrategy"/>
                <ref bean="productFileNameStrategy"/>
                <ref bean="shopFileNameStrategy"/>
                <ref bean="shopSystemFileNameStrategy"/>
                <ref bean="systemFileNameStrategy"/>
                <ref bean="systemSystemFileNameStrategy"/>
            </list>
        </constructor-arg>
    </bean>

    <bean id="fileNameStrategyResolver" class="org.yes.cart.service.media.impl.MediaFileNameStrategyResolverImpl">
        <constructor-arg index="0" ref="productFileNameStrategy"/>
        <constructor-arg index="1" ref="fileNameStrategyResolverStrategies"/>
    </bean>

    <bean id="fileService" class="org.yes.cart.service.domain.impl.FileServiceImpl">
        <constructor-arg type="org.yes.cart.service.media.MediaFileNameStrategyResolver" ref="fileNameStrategyResolver"/>
        <!--
            replaceFilesModeOn if set to true will overwrite existing file if name is
            the same. Recommended setting is 'true' because the import service refers to the
            original filename and thus does not save the rolling filename.
         -->
        <constructor-arg type="boolean" value="true"/>
        <!--
            IO operations abstraction
         -->
        <constructor-arg type="org.yes.cart.stream.io.IOProvider" ref="ioProviderFactory"/>
        <!--
            System Service allows to provide system wide settings
         -->
        <lookup-method name="getSystemService" bean="systemService"/>

        <property name="config" ref="runtimeConstants"/>

    </bean>

    <!--     #############################   Media section end   #############################    -->

    <bean id="productAssociationService" class="org.yes.cart.service.domain.impl.ProductAssociationServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.domain.impl.ProductAssociationServiceImpl">
                        <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="productAssociationDao"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="associationService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.AssociationServiceImpl">
                <constructor-arg type="org.yes.cart.dao.GenericDAO" ref="associationDao"/>
            </bean>
        </property>
    </bean>

    <bean id="priceService" class="org.yes.cart.service.domain.impl.PriceServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.domain.impl.PriceServiceImpl">
                        <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="skuPriceDao"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>


    <bean id="attributeGroupService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.AttributeGroupServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="attributeGroupDao"/>
            </bean>
        </property>
    </bean>


    <bean id="etypeService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.EtypeServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="etypeDao"/>
            </bean>
        </property>
    </bean>


    <bean id="shopCategoryService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ShopCategoryServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="shopCategoryDao"/>
                <constructor-arg index="1" type="org.yes.cart.dao.GenericDAO" ref="categoryDao"/>
                <constructor-arg index="2" type="org.yes.cart.dao.GenericDAO" ref="shopDao"/>
            </bean>
        </property>
    </bean>


    <bean id="brandService" class="org.yes.cart.service.domain.impl.BrandServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.domain.impl.BrandServiceImpl">
                        <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="brandDao"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="carrierService" class="org.yes.cart.service.domain.impl.CarrierServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.domain.impl.CarrierServiceImpl">
                        <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="carrierDao"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="carrierSlaService" class="org.yes.cart.service.domain.impl.CarrierSlaServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.domain.impl.CarrierSlaServiceImpl">
                        <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="carrierSlaDao"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="shopTopSellerService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ShopTopSellerServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="shopTopSellerDao"/>
                <constructor-arg index="1" type="org.yes.cart.dao.GenericDAO" ref="shopDao"/>
                <constructor-arg index="2" type="org.yes.cart.dao.GenericDAO" ref="productDao"/>
            </bean>
        </property>
    </bean>


    <bean id="warehouseService" class="org.yes.cart.service.domain.impl.WarehouseServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.domain.impl.WarehouseServiceImpl">
                        <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="warehouseDao"/>
                        <constructor-arg index="1" type="org.yes.cart.dao.GenericDAO" ref="shopDao"/>
                        <constructor-arg index="2" type="org.yes.cart.dao.GenericDAO" ref="shopWarehouseDao"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>


    <bean id="productTypeService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ProductTypeServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="productTypeDao"/>
            </bean>
        </property>
    </bean>


    <bean id="productTypeAttrService" class="org.yes.cart.service.domain.impl.ProductTypeAttrServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.domain.impl.ProductTypeAttrServiceImpl">
                        <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="productTypeAttrDao"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="countryService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.CountryServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="countryDao"/>
            </bean>
        </property>
    </bean>

    <bean id="stateService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.StateServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="stateDao"/>
            </bean>
        </property>
    </bean>


    <bean id="productCategoryService" class="org.yes.cart.service.domain.impl.ProductCategoryServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.domain.impl.ProductCategoryServiceImpl">
                        <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="productCategoryDao"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>


    <bean id="productOptionService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.ProductOptionServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="productOptionDao"/>
            </bean>
        </property>
    </bean>


    <bean id="customerOrderService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.CustomerOrderServiceImpl">
                <constructor-arg index="0"  ref="customerOrderDao"/>
                <constructor-arg index="1"  ref="customerDao"/>
                <constructor-arg index="2"  ref="genericDao"/>
                <constructor-arg index="3"  ref="customerOrderDeliveryDao"/>
                <constructor-arg index="4"  ref="orderNumberGenerator"/>
                <constructor-arg index="5"  ref="orderAssembler"/>
                <constructor-arg index="6"  ref="deliveryAssembler"/>
                <constructor-arg index="7"  ref="orderSplittingStrategy"/>
                <constructor-arg index="8"  ref="cartContentsValidator"/>
            </bean>
        </property>
    </bean>

    <bean id="customerOrderDeliveryDetService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.CustomerOrderDeliveryDetServiceImpl">
                <constructor-arg index="0"  ref="customerOrderDeliveryDetDao"/>
            </bean>
        </property>
    </bean>

    <bean id="customerService" class="org.yes.cart.service.domain.impl.CustomerServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.domain.impl.CustomerServiceImpl">
                        <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="customerDao"/>
                        <constructor-arg index="1" type="org.yes.cart.service.domain.HashHelper" ref="passwordHashHelper"/>
                        <constructor-arg index="2" type="org.yes.cart.dao.GenericDAO" ref="genericDao"/>
                        <constructor-arg index="3" type="org.yes.cart.service.domain.AttributeService" ref="attributeService"/>
                        <constructor-arg index="4" type="org.yes.cart.service.domain.ShopService" ref="shopService"/>
                        <constructor-arg index="5" type="org.yes.cart.service.customer.CustomerNameFormatter" ref="customerNameFormatter"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="shopCustomerCustomisationSupport" class="org.yes.cart.service.domain.impl.ShopCustomerCustomisationSupportImpl">
        <constructor-arg index="0" ref="customerService"/>
        <constructor-arg index="1" ref="attributeService"/>
    </bean>

    <bean id="customerRemoveService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.CustomerRemoveServiceImpl">
                <constructor-arg index="0" ref="customerService"/>
                <constructor-arg index="1" ref="customerOrderService"/>
            </bean>
        </property>
    </bean>

    <bean id="customerManagerService" class="org.yes.cart.service.domain.impl.CustomerManagerServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.domain.impl.CustomerManagerServiceImpl">
                        <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="managerDao"/>
                        <constructor-arg index="1" type="org.yes.cart.service.domain.HashHelper" ref="passwordHashHelper"/>
                        <constructor-arg index="2" type="org.yes.cart.service.domain.AttributeService" ref="attributeService"/>
                        <constructor-arg index="3" type="org.yes.cart.service.domain.ShopService" ref="shopService"/>
                        <constructor-arg index="4" type="org.yes.cart.service.customer.CustomerNameFormatter" ref="customerNameFormatter"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="managerService" class="org.yes.cart.service.domain.impl.ManagerServiceCachedImpl">
       <constructor-arg>
           <bean parent="txProxyTemplate">
               <property name="target">
                   <bean class="org.yes.cart.service.domain.impl.ManagerServiceImpl">
                       <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="managerDao"/>
                       <constructor-arg index="1" type="org.yes.cart.dao.GenericDAO" ref="roleDao"/>
                       <constructor-arg index="2" type="org.yes.cart.dao.GenericDAO" ref="managerRoleDao"/>
                   </bean>
               </property>
           </bean>
       </constructor-arg>
    </bean>

    <bean id="managerRoleService" parent="txProxyTemplate">
       <property name="target">
           <bean class="org.yes.cart.service.domain.impl.BaseGenericServiceImpl">
               <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="managerRoleDao"/>
           </bean>
       </property>
    </bean>

    <bean id="roleService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.BaseGenericServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="roleDao"/>
            </bean>
        </property>
    </bean>

    <bean id="skuWarehouseService" class="org.yes.cart.service.domain.impl.SkuWarehouseServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.domain.impl.SkuWarehouseServiceImpl">
                        <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="skuWarehouseDao"/>
                        <property name="productService" ref="productService"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="promotionCouponCodeGenerator" class="org.yes.cart.promotion.impl.PromotionCouponCodeGeneratorImpl">
        <constructor-arg index="0" value="10"/>
        <constructor-arg index="1" ref="shopService"/>
    </bean>

    <bean id="promotionCouponService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.PromotionCouponServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="promotionCouponDao"/>
                <constructor-arg index="1" type="org.yes.cart.dao.GenericDAO" ref="promotionDao"/>
                <constructor-arg index="2" ref="promotionCouponCodeGenerator"/>
            </bean>
        </property>
    </bean>

    <bean id="promotionService" class="org.yes.cart.service.domain.impl.PromotionServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.domain.impl.PromotionServiceImpl">
                        <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="promotionDao"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="promotionConditionParser" class="org.yes.cart.promotion.impl.GroovyPromotionConditionParser"/>

    <bean id="promotionConditionSupport" class="org.yes.cart.promotion.impl.PromotionConditionSupportCachedImpl">
        <constructor-arg>
            <bean class="org.yes.cart.promotion.impl.PromotionConditionSupportImpl">
                <constructor-arg index="0" ref="productService"/>
                <constructor-arg index="1" ref="brandService"/>
                <constructor-arg index="2" ref="shopService"/>
                <constructor-arg index="3" ref="categoryService"/>
                <constructor-arg index="4" ref="productCategoryService"/>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="bestValuePromotionApplicationStrategy" class="org.yes.cart.promotion.impl.BestValuePromotionApplicationStrategyImpl">
        <constructor-arg index="0" ref="promotionCouponService"/>
    </bean>

    <bean id="promotionContextFactoryActionsMapping" class="org.yes.cart.utils.spring.LinkedHashMapBeanImpl">
        <constructor-arg>
            <map>
                <entry key="O">
                    <map>
                        <entry key="P" value-ref="promoActionOrderDiscount"/>
                        <entry key="S" value-ref="promoActionOrderNonSaleDiscount"/>
                        <entry key="F" value-ref="promoActionOrderAmountOff"/>
                        <entry key="G" value-ref="promoActionOrderGift"/>
                        <entry key="C" value-ref="promoActionOrderSurcharge"/>
                    </map>
                </entry>
                <entry key="S">
                    <map>
                        <entry key="P" value-ref="promoActionShippingDiscount"/>
                        <entry key="F" value-ref="promoActionShippingAmountOff"/>
                        <entry key="C" value-ref="promoActionShippingSurcharge"/>
                    </map>
                </entry>
                <entry key="I">
                    <map>
                        <entry key="P" value-ref="promoActionItemDiscount"/>
                        <entry key="S" value-ref="promoActionItemNonSaleDiscount"/>
                        <entry key="F" value-ref="promoActionItemAmountOff"/>
                        <entry key="G" value-ref="promoActionItemGift"/>
                        <entry key="C" value-ref="promoActionItemSurcharge"/>
                    </map>
                </entry>
                <entry key="C">
                    <map>
                        <entry key="T" value-ref="promoActionCustomerTag"/>
                    </map>
                </entry>
            </map>
        </constructor-arg>
    </bean>

    <bean id="promotionContextFactory" class="org.yes.cart.promotion.impl.PromotionContextFactoryCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.promotion.impl.PromotionContextFactoryImpl">
                        <constructor-arg index="0" ref="shopService"/>
                        <constructor-arg index="1" ref="promotionService"/>
                        <constructor-arg index="2" ref="promotionConditionParser"/>
                        <constructor-arg index="3" ref="promotionContextFactoryActionsMapping"/>
                        <constructor-arg index="4" ref="bestValuePromotionApplicationStrategy"/>
                        <constructor-arg index="5" ref="promotionConditionSupport"/>
                        <constructor-arg index="6" ref="pricingPolicyProvider"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="promotionCouponContextActionsMapping" class="org.yes.cart.utils.spring.LinkedHashMapBeanImpl">
        <constructor-arg>
            <map>
                <entry key="P" value-ref="promoActionOrderDiscount"/>
                <entry key="S" value-ref="promoActionOrderNonSaleDiscount"/>
                <entry key="F" value-ref="promoActionOrderAmountOff"/>
            </map>
        </constructor-arg>
    </bean>

    <bean id="promotionCouponContext" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.promotion.impl.PromotionCouponContextImpl">
                <constructor-arg index="0" ref="promotionCouponService"/>
                <constructor-arg index="1" ref="promotionConditionParser"/>
                <constructor-arg index="2" ref="promotionCouponContextActionsMapping"/>
                <constructor-arg index="3" ref="bestValuePromotionApplicationStrategy"/>
            </bean>
        </property>
    </bean>

    <bean id="promoActionItemDiscount" class="org.yes.cart.promotion.impl.action.ItemDiscountPromotionAction"/>
    <bean id="promoActionItemNonSaleDiscount" class="org.yes.cart.promotion.impl.action.ItemNonSaleDiscountPromotionAction"/>
    <bean id="promoActionItemAmountOff" class="org.yes.cart.promotion.impl.action.ItemAmountOffPromotionAction"/>
    <bean id="promoActionItemGift" class="org.yes.cart.promotion.impl.action.ItemGiftPromotionAction">
        <constructor-arg index="0" ref="priceResolver"/>
        <constructor-arg index="1" ref="inventoryResolver"/>
        <constructor-arg index="2" ref="shopService"/>
        <constructor-arg index="3" ref="warehouseService"/>
        <constructor-arg index="4" ref="productService"/>
        <constructor-arg index="5" ref="orderSplittingStrategy"/>
    </bean>
    <bean id="promoActionItemSurcharge" class="org.yes.cart.promotion.impl.action.ItemSurchargePromotionAction"/>

    <bean id="promoActionOrderDiscount" class="org.yes.cart.promotion.impl.action.OrderDiscountPromotionAction"/>
    <bean id="promoActionOrderNonSaleDiscount" class="org.yes.cart.promotion.impl.action.OrderNonSaleDiscountPromotionAction"/>
    <bean id="promoActionOrderAmountOff" class="org.yes.cart.promotion.impl.action.OrderAmountOffPromotionAction"/>
    <bean id="promoActionOrderGift" class="org.yes.cart.promotion.impl.action.OrderGiftPromotionAction">
        <constructor-arg index="0" ref="priceResolver"/>
        <constructor-arg index="1" ref="inventoryResolver"/>
        <constructor-arg index="2" ref="shopService"/>
        <constructor-arg index="3" ref="warehouseService"/>
        <constructor-arg index="4" ref="productService"/>
        <constructor-arg index="5" ref="orderSplittingStrategy"/>
    </bean>
    <bean id="promoActionOrderSurcharge" class="org.yes.cart.promotion.impl.action.OrderSurchargePromotionAction"/>

    <bean id="promoActionShippingDiscount" class="org.yes.cart.promotion.impl.action.ShippingDiscountPromotionAction"/>
    <bean id="promoActionShippingAmountOff" class="org.yes.cart.promotion.impl.action.ShippingAmountOffPromotionAction"/>
    <bean id="promoActionShippingSurcharge" class="org.yes.cart.promotion.impl.action.ShippingSurchargePromotionAction"/>

    <bean id="promoActionCustomerTag" class="org.yes.cart.promotion.impl.action.CustomerTagPromotionAction"/>

    <bean id="promotionTester" class="org.yes.cart.promotion.impl.PromotionTesterImpl">
        <constructor-arg index="0" ref="shopService"/>
        <constructor-arg index="1" ref="priceService"/>
        <constructor-arg index="2" ref="promotionContextFactory"/>
        <constructor-arg index="3" ref="carrierSlaService"/>
        <constructor-arg index="4" ref="amountCalculationStrategy"/>
        <constructor-arg index="5" ref="shoppingCartCommandFactory"/>
    </bean>

    <bean id="taxService" class="org.yes.cart.service.domain.impl.TaxServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.domain.impl.TaxServiceImpl">
                        <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="taxDao"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="taxConfigService" class="org.yes.cart.service.domain.impl.TaxConfigServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.domain.impl.TaxConfigServiceImpl">
                        <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="taxConfigDao"/>
                        <constructor-arg index="1" ref="taxService"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="shoppingCartCalculator" class="org.yes.cart.service.domain.impl.ShoppingCartCalculatorImpl">
        <constructor-arg index="0" ref="amountCalculationStrategy"/>
    </bean>

    <bean id="mailService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.MailServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="mailDao"/>
            </bean>
        </property>
    </bean>



    <bean id="dataGroupService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.DataGroupServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="dataGroupDao"/>
            </bean>
        </property>
    </bean>

    <bean id="dataDescriptorService" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.DataDescriptorServiceImpl">
                <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="dataDescriptorDao"/>
            </bean>
        </property>
    </bean>

    <bean id="jobDefinitionService" class="org.yes.cart.service.domain.impl.JobDefinitionServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.domain.impl.JobDefinitionServiceImpl">
                        <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="jobDefinitionDao"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="jobService" class="org.yes.cart.service.domain.impl.JobServiceCachedImpl">
        <constructor-arg>
            <bean parent="txProxyTemplate">
                <property name="target">
                    <bean class="org.yes.cart.service.domain.impl.JobServiceImpl">
                        <constructor-arg index="0" type="org.yes.cart.dao.GenericDAO" ref="jobDao"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>


    <!-- ############################# ExtendedConversionService ################################# -->

    <bean id="extendedConversionService" class="org.yes.cart.service.misc.impl.ExtendedConversionService"/>

    <!-- ########################################### Mail ######################################## -->

    <bean id="mailTemplateResourcesProviderShopContent"
          class="org.yes.cart.service.mail.impl.MailTemplateResourcesProviderShopContentImpl">
        <constructor-arg index="0" ref="contentService"/>
        <constructor-arg index="1" ref="contentImageNameStrategy"/>
        <constructor-arg index="2" ref="systemService"/>
        <constructor-arg index="3" ref="imageService"/>
    </bean>

    <bean id="mailTemplateResourcesProviderTheme"
          class="org.yes.cart.service.mail.impl.MailTemplateResourcesProviderThemeImpl">
        <constructor-arg index="0" ref="themeRepositoryService"/>
    </bean>

    <bean id="mailTemplateResourcesProvider"
          class="org.yes.cart.service.mail.impl.MailTemplateResourcesProviderFactoryImpl">
        <constructor-arg index="0">
            <list>
                <!--
                    Order here is important as factory will take the first provider that is able to
                    provide non-empty value
                -->
                <ref bean="mailTemplateResourcesProviderShopContent"/>
                <ref bean="mailTemplateResourcesProviderTheme"/>
            </list>
        </constructor-arg>
    </bean>

    <bean id="mailComposer" class="org.yes.cart.service.mail.impl.MailComposerImpl">
        <constructor-arg index="0" ref="mailTemplateResourcesProvider"/>
        <constructor-arg index="1">
            <bean class="org.yes.cart.service.theme.templates.impl.TemplateProcessorFactoryImpl">
                <constructor-arg>
                    <array>
                        <bean class="org.yes.cart.service.mail.impl.MailComposerTemplateSupportThymeleafImpl">
                            <constructor-arg>
                                <bean class="org.yes.cart.service.theme.templates.impl.ThymeleafTemplateSupportImpl">
                                    <constructor-arg ref="cacheManager"/>
                                </bean>
                            </constructor-arg>
                        </bean>
                        <bean class="org.yes.cart.service.mail.impl.MailComposerTemplateSupportGroovyImpl">
                            <constructor-arg>
                                <bean class="org.yes.cart.service.theme.templates.impl.GroovyGStringTemplateSupportImpl">
                                    <constructor-arg ref="cacheManager"/>
                                </bean>
                            </constructor-arg>
                        </bean>
                    </array>
                </constructor-arg>
            </bean>
        </constructor-arg>
    </bean>

    <!-- ############################# Shopping Cart Commands and Events ######################### -->

    <bean id="customerResolver" class="org.yes.cart.shoppingcart.impl.CustomerResolverDefaultImpl">
        <constructor-arg index="0" ref="customerService"/>
        <constructor-arg index="1" ref="customerManagerService"/>
    </bean>

    <bean id="shoppingCartCommandConfigurationCheckoutVisitor" class="org.yes.cart.shoppingcart.impl.ShoppingCartCommandConfigurationCheckoutVisitorImpl">
        <constructor-arg index="0" ref="customerResolver"/>
        <constructor-arg index="1" ref="shopService"/>
        <property name="visitorId" value="CHECKOUT"/>
    </bean>

    <bean id="shoppingCartCommandConfigurationCustomerTypeVisitor" class="org.yes.cart.shoppingcart.impl.ShoppingCartCommandConfigurationCustomerTypeVisitorImpl">
        <constructor-arg index="0" ref="customerResolver"/>
        <constructor-arg index="1" ref="shopService"/>
        <property name="visitorId" value="CUSTOMERTYPE"/>
    </bean>

    <bean id="shoppingCartCommandConfigurationCustomerVisitor" class="org.yes.cart.shoppingcart.impl.ShoppingCartCommandConfigurationCustomerVisitorImpl">
        <constructor-arg index="0" ref="customerResolver"/>
        <constructor-arg index="1" ref="shopService"/>
        <property name="visitorId" value="CUSTOMER"/>
    </bean>

    <bean id="shoppingCartCommandConfigurationDefaultAddressVisitor" class="org.yes.cart.shoppingcart.impl.ShoppingCartCommandConfigurationDefaultAddressVisitorImpl">
        <constructor-arg index="0" ref="customerResolver"/>
        <constructor-arg index="1" ref="shopService"/>
        <property name="visitorId" value="DEFAULTADDRESS"/>
    </bean>

    <bean id="shoppingCartCommandConfigurationTaxOptionsVisitor" class="org.yes.cart.shoppingcart.impl.ShoppingCartCommandConfigurationTaxOptionsVisitorImpl">
        <constructor-arg index="0" ref="customerResolver"/>
        <constructor-arg index="1" ref="shopService"/>
        <property name="visitorId" value="TAX"/>
    </bean>

    <bean id="shoppingCartCommandConfigurationProvider" class="org.yes.cart.shoppingcart.impl.ShoppingCartCommandConfigurationProviderImpl">
        <constructor-arg index="0">
            <set>
                <ref bean="shoppingCartCommandConfigurationCheckoutVisitor"/>
                <ref bean="shoppingCartCommandConfigurationCustomerTypeVisitor"/>
                <ref bean="shoppingCartCommandConfigurationCustomerVisitor"/>
                <ref bean="shoppingCartCommandConfigurationDefaultAddressVisitor"/>
                <ref bean="shoppingCartCommandConfigurationTaxOptionsVisitor"/>
            </set>
        </constructor-arg>
    </bean>

    <bean id="shoppingCartCommandFactory" class="org.yes.cart.shoppingcart.impl.ShoppingCartCommandFactoryImpl">
        <constructor-arg index="0" ref="shoppingCartCommandConfigurationProvider"/>
    </bean>

    <bean id="amountCalculationStrategy"
          class="org.yes.cart.shoppingcart.impl.DefaultAmountCalculationStrategy">
        <constructor-arg index="0" ref="taxProvider"/>
        <constructor-arg index="1" ref="deliveryCostCalculationStrategy"/>
        <constructor-arg index="2" ref="promotionContextFactory"/>
        <constructor-arg index="3" ref="customerService"/>
        <constructor-arg index="4" ref="shopService"/>
    </bean>

    <bean id="defaultDeliveryCostRegionalPriceResolver" class="org.yes.cart.shoppingcart.impl.DeliveryCostRegionalPriceResolverImpl">
        <constructor-arg index="0" ref="priceResolver"/>
        <constructor-arg index="1" ref="shopService"/>
    </bean>

    <bean id="deliveryCostCalculationStrategyMapping" class="org.yes.cart.utils.spring.LinkedHashMapBeanImpl">
        <constructor-arg>
            <map>
                <entry key="R">
                    <bean class="org.yes.cart.shoppingcart.impl.FreeDeliveryCostCalculationStrategy">
                        <constructor-arg index="0" ref="carrierSlaService"/>
                        <constructor-arg index="1" ref="pricingPolicyProvider"/>
                        <constructor-arg index="2" ref="defaultDeliveryCostRegionalPriceResolver"/>
                    </bean>
                </entry>
                <entry key="O">
                    <bean class="org.yes.cart.shoppingcart.impl.OfflineDeliveryCostCalculationStrategy">
                        <constructor-arg index="0" ref="carrierSlaService"/>
                        <constructor-arg index="1" ref="pricingPolicyProvider"/>
                        <constructor-arg index="2" ref="defaultDeliveryCostRegionalPriceResolver"/>
                    </bean>
                </entry>
                <entry key="E">
                    <bean class="org.yes.cart.shoppingcart.impl.ExternalDeliveryCostCalculationStrategy">
                        <constructor-arg index="0" ref="carrierSlaService"/>
                    </bean>
                </entry>
                <entry key="F">
                    <bean class="org.yes.cart.shoppingcart.impl.PriceListDeliveryCostCalculationStrategy">
                        <constructor-arg index="0" ref="carrierSlaService"/>
                        <constructor-arg index="1" ref="pricingPolicyProvider"/>
                        <constructor-arg index="2" ref="defaultDeliveryCostRegionalPriceResolver"/>
                    </bean>
                </entry>
                <entry key="W">
                    <bean class="org.yes.cart.shoppingcart.impl.WeightBasedPriceListDeliveryCostCalculationStrategy">
                        <constructor-arg index="0" ref="carrierSlaService"/>
                        <constructor-arg index="1" ref="productService"/>
                        <constructor-arg index="2" ref="pricingPolicyProvider"/>
                        <constructor-arg index="3" ref="defaultDeliveryCostRegionalPriceResolver"/>
                    </bean>
                </entry>
            </map>
        </constructor-arg>
    </bean>

    <bean id="deliveryCostCalculationStrategy"  class="org.yes.cart.shoppingcart.impl.DefaultDeliveryCostCalculationStrategy">
        <constructor-arg index="0" ref="carrierSlaService"/>
        <constructor-arg index="1" ref="deliveryCostCalculationStrategyMapping"/>
    </bean>

    <bean id="deliveryTimeEstimationVisitorDefault" class="org.yes.cart.shoppingcart.impl.DeliveryTimeEstimationVisitorDefaultImpl">
        <constructor-arg index="0" ref="warehouseService"/>
        <constructor-arg index="1" ref="carrierSlaService"/>
        <property name="cfgContext">
            <bean class="org.yes.cart.config.impl.ConfigurationContextImpl">
                <property name="functionalArea" value="fulfilment"/>
                <property name="name" value="deliveryTimeEstimationVisitorDefault"/>
                <property name="cfgInterface" value="DeliveryTimeEstimationVisitor"/>
                <property name="cfgDefault" value="true"/>
                <property name="properties">
                    <props>
                        <prop key="extension">SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]</prop>
                        <prop key="description">Default service that can be overridden via system properties (Disable by commenting out in SYSTEM_EXTENSION_CFG_PROPERTIES using '#')</prop>
                        <prop key="SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]">SHOPCODE.deliveryTimeEstimationVisitor=configurationBeanName, where SHOPCODE is the code of the shop and deliveryTimeEstimationVisitor is custom implementation</prop>
                    </props>
                </property>
            </bean>
        </property>
    </bean>

    <bean id="deliveryTimeEstimationVisitor" class="org.yes.cart.shoppingcart.impl.DeliveryTimeEstimationVisitorImpl">
        <constructor-arg index="0" ref="shopService"/>
        <constructor-arg index="1" ref="deliveryTimeEstimationVisitorDefault"/>
    </bean>

    <bean id="taxProviderDefault" class="org.yes.cart.shoppingcart.impl.TaxProviderDefaultImpl">
        <constructor-arg index="0" ref="taxService"/>
        <constructor-arg index="1" ref="taxConfigService"/>
        <property name="cfgContext">
            <bean class="org.yes.cart.config.impl.ConfigurationContextImpl">
                <property name="functionalArea" value="pricing"/>
                <property name="name" value="taxProviderDefault"/>
                <property name="cfgInterface" value="TaxProvider"/>
                <property name="cfgDefault" value="true"/>
                <property name="properties">
                    <props>
                        <prop key="extension">SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]</prop>
                        <prop key="description">Default service that can be overridden via system properties (Disable by commenting out in SYSTEM_EXTENSION_CFG_PROPERTIES using '#')</prop>
                        <prop key="SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]">SHOPCODE.taxProvider=configurationBeanName, where SHOPCODE is the code of the shop and configurationBeanName is custom implementation</prop>
                    </props>
                </property>
            </bean>
        </property>
    </bean>

    <bean id="taxProvider" class="org.yes.cart.shoppingcart.impl.TaxProviderImpl">
        <constructor-arg index="0" ref="taxProviderDefault"/>
    </bean>

    <bean id="pricingPolicyProviderCustomerAttribute" class="org.yes.cart.shoppingcart.impl.PricingPolicyProviderCustomerAttributeImpl">
        <constructor-arg index="0" ref="customerService"/>
        <constructor-arg index="1" ref="shopService"/>
        <property name="cfgContext">
            <bean class="org.yes.cart.config.impl.ConfigurationContextImpl">
                <property name="functionalArea" value="pricing"/>
                <property name="name" value="pricingPolicyProviderCustomerAttribute"/>
                <property name="cfgInterface" value="PricingPolicyProvider"/>
                <property name="cfgDefault" value="true"/>
                <property name="properties">
                    <props>
                        <prop key="extension">SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]</prop>
                        <prop key="description">Default service that can be overridden via system properties (Disable by commenting out in SYSTEM_EXTENSION_CFG_PROPERTIES using '#')</prop>
                        <prop key="SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]">SHOPCODE.pricingPolicyProvider=configurationBeanName, where SHOPCODE is the code of the shop and configurationBeanName is custom implementation</prop>
                    </props>
                </property>
            </bean>
        </property>
    </bean>

    <bean id="pricingPolicyProvider" class="org.yes.cart.shoppingcart.impl.PricingPolicyProviderImpl">
        <constructor-arg index="0" ref="pricingPolicyProviderCustomerAttribute"/>
    </bean>

    <bean id="priceResolverDefault" class="org.yes.cart.shoppingcart.impl.PriceResolverDefaultImpl">
        <constructor-arg index="0" ref="priceService"/>
        <property name="cfgContext">
            <bean class="org.yes.cart.config.impl.ConfigurationContextImpl">
                <property name="functionalArea" value="pricing"/>
                <property name="name" value="priceResolverDefault"/>
                <property name="cfgInterface" value="PriceResolver"/>
                <property name="cfgDefault" value="true"/>
                <property name="properties">
                    <props>
                        <prop key="extension">SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]</prop>
                        <prop key="description">Default service that can be overridden via system properties (Disable by commenting out in SYSTEM_EXTENSION_CFG_PROPERTIES using '#')</prop>
                        <prop key="SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]">SHOPCODE.priceResolver=configurationBeanName, where SHOPCODE is the code of the shop and configurationBeanName is custom implementation</prop>
                    </props>
                </property>
            </bean>
        </property>
    </bean>

    <bean id="priceResolver" class="org.yes.cart.shoppingcart.impl.PriceResolverImpl">
        <constructor-arg index="0" ref="priceResolverDefault"/>
    </bean>

    <bean id="inventoryResolverDefault" class="org.yes.cart.shoppingcart.impl.InventoryResolverDefaultImpl">
        <constructor-arg index="0" ref="skuWarehouseService"/>
        <property name="cfgContext">
            <bean class="org.yes.cart.config.impl.ConfigurationContextImpl">
                <property name="functionalArea" value="inventory"/>
                <property name="name" value="inventoryResolverDefault"/>
                <property name="cfgInterface" value="InventoryResolver"/>
                <property name="cfgDefault" value="true"/>
                <property name="properties">
                    <props>
                        <prop key="extension">SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]</prop>
                        <prop key="description">Default service that can be overridden via system properties (Disable by commenting out in SYSTEM_EXTENSION_CFG_PROPERTIES using '#')</prop>
                        <prop key="SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]">FFCODE.inventoryResolver=configurationBeanName, where FFCODE is the code of the centre and configurationBeanName is custom implementation</prop>
                    </props>
                </property>
            </bean>
        </property>
    </bean>

    <bean id="inventoryResolver" class="org.yes.cart.shoppingcart.impl.InventoryResolverImpl">
        <constructor-arg index="0" ref="inventoryResolverDefault"/>
    </bean>

    <bean id="baseCartContentsValidator" class="org.yes.cart.shoppingcart.impl.CompoundCartContentsValidator">
        <constructor-arg index="0">
            <list>
                <bean class="org.yes.cart.shoppingcart.impl.CheckoutBlockedValidator"/>
                <bean class="org.yes.cart.shoppingcart.impl.ItemsAvailableValidator"/>
            </list>
        </constructor-arg>
        <property name="cfgContext">
            <bean class="org.yes.cart.config.impl.ConfigurationContextImpl">
                <property name="functionalArea" value="checkout"/>
                <property name="name" value="baseCartContentsValidator"/>
                <property name="cfgInterface" value="CartContentsValidator"/>
                <property name="cfgDefault" value="true"/>
                <property name="properties">
                    <props>
                        <prop key="extension">SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]</prop>
                        <prop key="description">Default service that can be overridden via system properties (Disable by commenting out in SYSTEM_EXTENSION_CFG_PROPERTIES using '#')</prop>
                        <prop key="SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]">SHOPCODE.cartContentsValidator=configurationBeanName, where SHOPCODE is the code of the shop and configurationBeanName is custom implementation</prop>
                    </props>
                </property>
            </bean>
        </property>
    </bean>

    <bean id="cartContentsValidator" class="org.yes.cart.shoppingcart.impl.DefaultCartContentsValidator">
        <constructor-arg index="0" ref="baseCartContentsValidator"/>
    </bean>

    <bean id="orderNumberGenerator"  parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.order.impl.DefaultOrderNumberGeneratorImpl">
                <constructor-arg index="0" ref="customerOrderDao"/>
            </bean>
        </property>
    </bean>

    <bean id="orderAddressFormatter" class="org.yes.cart.service.order.impl.DefaultOrderAddressFormatterImpl">
        <constructor-arg index="0" value="{{addrline1}} {{addrline2}} {{postcode}} {{city}} {{countrycode}} {{statecode}}, {{salutation}} {{firstname}} {{middlename}} {{lastname}}, {{phone1}} {{mobile1}} {{email1}}"/>
    </bean>

    <bean id="customerNameFormatter" class="org.yes.cart.service.customer.impl.DefaultCustomerNameFormatterImpl">
        <constructor-arg index="0" value="{{firstname}} {{middlename}} {{lastname}}"/>
    </bean>

    <bean id="noopOrderAssemblerPostProcessor" class="org.yes.cart.service.order.impl.ConfiguredOrderAssemblerPostProcessor">
        <property name="processor">
            <bean class="org.yes.cart.service.order.impl.NoopOrderAssemblerPostProcessorImpl"/>
        </property>
        <property name="cfgContext">
            <bean class="org.yes.cart.config.impl.ConfigurationContextImpl">
                <property name="functionalArea" value="checkout"/>
                <property name="name" value="noopOrderAssemblerPostProcessor"/>
                <property name="cfgInterface" value="OrderAssemblerPostProcessor"/>
                <property name="cfgDefault" value="true"/>
                <property name="properties">
                    <props>
                        <prop key="extension">SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]</prop>
                        <prop key="description">Default service that can be overridden via system properties (Disable by commenting out in SYSTEM_EXTENSION_CFG_PROPERTIES using '#')</prop>
                        <prop key="SYSTEM[SYSTEM_EXTENSION_CFG_PROPERTIES]">SHOPCODE.orderAssemblerPostProcessor=configurationBeanName, where SHOPCODE is the code of the shop and configurationBeanName is custom implementation</prop>
                    </props>
                </property>
            </bean>
        </property>
    </bean>

    <bean id="orderAssembler" parent="txProxyTemplate">
        <property name="target">
            <bean  class="org.yes.cart.service.order.impl.OrderAssemblerImpl">
                <constructor-arg index="0" ref="genericDao"/>
                <constructor-arg index="1" ref="customerService"/>
                <constructor-arg index="2" ref="shopService"/>
                <constructor-arg index="3" ref="productService"/>
                <constructor-arg index="4" ref="productSkuService"/>
                <constructor-arg index="5" ref="priceResolver"/>
                <constructor-arg index="6" ref="inventoryResolver"/>
                <constructor-arg index="7" ref="orderAddressFormatter"/>
                <constructor-arg index="8" ref="promotionCouponService"/>
                <constructor-arg index="9" ref="addressService"/>
                <constructor-arg index="10" ref="attributeService"/>
                <constructor-arg index="11" ref="warehouseService"/>
            </bean>
        </property>
    </bean>

    <bean id="orderDisassembler" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.yes.cart.service.order.impl.OrderDisassemblerImpl">
                <constructor-arg index="0" ref="amountCalculationStrategy"/>
                <constructor-arg index="1" ref="customerService"/>
            </bean>
        </property>
    </bean>

    <bean id="orderSplittingStrategy" class="org.yes.cart.service.order.impl.OrderSplittingStrategyImpl">
        <constructor-arg index="0" ref="shopService"/>
        <constructor-arg index="1" ref="productService"/>
        <constructor-arg index="2" ref="warehouseService"/>
        <constructor-arg index="3" ref="inventoryResolver"/>
    </bean>

    <bean id="deliveryAssembler" class="org.yes.cart.service.order.impl.DeliveryAssemblerImpl">
        <constructor-arg index="0" ref="warehouseService"/>
        <constructor-arg index="1" ref="carrierSlaService"/>
        <constructor-arg index="2" ref="orderSplittingStrategy"/>
    </bean>

    <!-- ############################################ misc ####################################### -->

    <bean id="themeRepositoryService" class="org.yes.cart.service.theme.templates.impl.ThemeRepositoryServiceImpl"/>

    <bean id="themeService" class="org.yes.cart.service.theme.impl.ThemeServiceImpl">
        <constructor-arg index="0" ref="shopService"/>
    </bean>

    <bean id="pluralFormService" class="org.yes.cart.service.misc.impl.PluralFormServiceImpl"/>

    <bean id="passPhraseGenerator" class="org.yes.cart.service.domain.impl.PassPhraseGeneratorImpl">
        <constructor-arg index="0" value="8"/>
    </bean>

    <bean id="passwordHashHelper" class="org.springframework.aop.framework.ProxyFactoryBean">
        <property name="target">
            <bean class="org.yes.cart.service.domain.impl.MD5HashHelperImpl">
                <property name="config" ref="runtimeConstants"/>
                <lookup-method name="getSelf" bean="passwordHashHelper"/>
            </bean>
        </property>
    </bean>

    <bean id="languageService" class="org.yes.cart.service.misc.impl.LanguageServiceImpl">
        <constructor-arg index="0" ref="runtimeConstants"/>
        <constructor-arg index="1" ref="shopService"/>
    </bean>

    <bean id="currencyService" class="org.yes.cart.service.misc.impl.CurrencyServiceImpl">
        <constructor-arg index="0" ref="runtimeConstants"/>
        <constructor-arg index="1" ref="shopService"/>
    </bean>

    <import resource="classpath*:core-services-ext.xml"/>

    <import resource="core-security.xml"/>

    <!-- ################################ Register module  ####################################################### -->

    <bean class="org.yes.cart.env.impl.ModuleImpl">
        <property name="functionalArea" value="core"/>
        <property name="name" value="core"/>
        <property name="subName" value="core-services"/>
    </bean>

</beans>